<!--DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Pixel Uploader</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 500px;
      margin: 40px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      box-sizing: border-box;
    }
    button {
      background: black;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #333;
    }
  </style>
</head>
<body>
  <h2>üõ†Ô∏è Admin Tool ‚Äì Add New Pixel</h2>

  <form id="adminForm">
    <input type="url" name="image" placeholder="Image URL (10x10 PNG)" required>
    <input type="url" name="link" placeholder="Click-through URL" required>
    <input type="text" name="tooltip" placeholder="Tooltip text" required>
    <input type="number" name="x" min="0" max="990" placeholder="X coordinate (0-990)" required>
    <input type="number" name="y" min="0" max="990" placeholder="Y coordinate (0-990)" required>
    <button type="submit">Add Pixel</button>
  </form>

  <button id="download">üì• Download Updated pixels.json</button>

  <script>
    let pixelData = [];

    // Load current pixel data
    fetch('pixels.json')
      .then(res => res.json())
      .then(data => {
        pixelData = data;
      })
      .catch(err => alert("Couldn't load pixels.json"));

    // Handle form submission
    document.getElementById('adminForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const form = e.target;
      const newPixel = {
        image: form.image.value,
        link: form.link.value,
        tooltip: form.tooltip.value,
        x: parseInt(form.x.value),
        y: parseInt(form.y.value)
      };

      pixelData.push(newPixel);
      alert('Pixel added! Now click the download button to export the new JSON.');
      form.reset();
    });

    // Download updated pixels.json
    document.getElementById('download').addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(pixelData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'pixels.json';
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html-->



<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ‚úÖ Protection BEFORE anything renders -->
  <script type="text/javascript">
    if (localStorage.getItem("admin-auth") !== "true") {
      window.location.href = "admin-login.html";
    }
  </script>

  <meta charset="UTF-8">
  <title>helpYourFather AdminLoggedIn </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  
</head>
<body class="bg-light d-flex">
  <!-- Sidebar -->
  <div class="d-flex flex-column flex-shrink-0 p-3 bg-dark text-white" style="width: 250px; height: 100vh; position: fixed;">
    <a href="#" class="d-flex align-items-center mb-3 text-white text-decoration-none">
      <span class="fs-4">üõ† Admin</span>
    </a>
    <hr>
    <ul class="nav nav-pills flex-column mb-auto">
      <li><a href="#" class="nav-link active text-white">Dashboard</a></li>
      <li><a href="#" onclick="logout()" class="nav-link text-white">Logout</a></li>
    </ul>
  </div>

  <!-- Content -->
  <div class="container-fluid" style="margin-left: 250px; padding-top: 40px;">
    <h2 class="text-center mb-4">Pixel Submissions</h2>
    <div class="row mb-3">
  <div class="col-md-4">
    <select id="filterStatus" class="form-select">
      <option value="all">Show All</option>
      <option value="approved">Approved</option>
      <option value="pending">Pending</option>
    </select>
  </div>
  <div class="col-md-4">
    <input id="searchText" type="text" class="form-control" placeholder="Search by email or tooltip...">
  </div>
  <div class="col-md-4">
    <button class="btn btn-primary w-100" onclick="applyFilters()">üîç Apply Filters</button>
  </div>
</div>

    <div id="pixelList" class="row gy-3"></div>
  </div>

<script>
  function logout() {
    localStorage.removeItem("admin-auth");
    window.location.href = "admin-login.html";
  }
</script>

  <script>
    /*async function fetchPixels() {
      const res = await fetch('https://helpyourfather.onrender.com/api/admin/pixels');
      const pixels = await res.json();
      const list = document.getElementById('pixelList');

      pixels.forEach(pixel => {
        const col = document.createElement('div');
        col.className = "col-md-4";

        const approvedBadge = pixel.approved
          ? '<span class="badge bg-success">Approved</span>'
          : '<span class="badge bg-warning text-dark">Pending</span>';

        col.innerHTML = `
          <div class="card shadow-sm">
            <img src="https://helpyourfather.onrender.com/uploads/${pixel.image}" class="card-img-top" style="height: 150px; object-fit: cover;">
            <div class="card-body">
              <h5 class="card-title">${pixel.name}</h5>
              <p class="card-text"><strong>Tooltip:</strong> ${pixel.tooltip}<br>
              <strong>Email:</strong> ${pixel.ownerEmail}<br>
              <strong>Coords:</strong> (${pixel.x}, ${pixel.y})<br>
              ${approvedBadge}</p>
              <div class="d-flex justify-content-between">
                ${!pixel.approved ? `<button class="btn btn-success btn-sm" onclick="approvePixel('${pixel._id}')">‚úÖ Approve</button>` : ''}
                <button class="btn btn-danger btn-sm" onclick="deletePixel('${pixel._id}')">üóëÔ∏è Delete</button>
              </div>
            </div>
          </div>
        `;

        list.appendChild(col);
      });*/

      //updated
    let allPixels = [];

    async function fetchPixels() {
        const res = await fetch('https://helpyourfather.onrender.com/api/admin/pixels');
        allPixels = await res.json();
        renderPixels(allPixels);
      }

      function renderPixels(pixels) {
        const list = document.getElementById('pixelList');
        list.innerHTML = "";

        pixels.forEach(pixel => {
          const col = document.createElement('div');
          col.className = "col-md-4";

          const approvedBadge = pixel.approved
            ? '<span class="badge bg-success">Approved</span>'
            : '<span class="badge bg-warning text-dark">Pending</span>';

          col.innerHTML = `
            <div class="card shadow-sm">
              <img src="${pixel.image}" class="card-img-top" style="height: 150px; object-fit: cover;">
              <div class="card-body">
                <h5 class="card-title">${pixel.name}</h5>
                <p class="card-text"><strong>Tooltip:</strong> ${pixel.tooltip}<br>
                <strong>Email:</strong> ${pixel.ownerEmail}<br>
                <strong>Coords:</strong> (${pixel.x}, ${pixel.y})<br>
                ${approvedBadge}</p>
                <div class="d-flex justify-content-between">
                  ${!pixel.approved ? `<button class="btn btn-success btn-sm" onclick="approvePixel('${pixel._id}')">‚úÖ Approve</button>` : ''}
                  <button class="btn btn-danger btn-sm" onclick="deletePixel('${pixel._id}')">üóëÔ∏è Delete</button>
                </div>
              </div>
            </div>
          `;

          list.appendChild(col);
        });
      }



    

    function applyFilters() {
      const status = document.getElementById('filterStatus').value;
      const search = document.getElementById('searchText').value.toLowerCase();

      const filtered = allPixels.filter(p => {
      const matchStatus =
      status === "all" ||
      (status === "approved" && p.approved) ||
      (status === "pending" && !p.approved);

      const matchText =
      p.ownerEmail.toLowerCase().includes(search) ||
      p.tooltip.toLowerCase().includes(search);

    return matchStatus && matchText;
  });

  renderPixels(filtered);
  }


    async function approvePixel(id) {
      const res = await fetch(`https://helpyourfather.onrender.com/api/admin/pixels/${id}/approve`, { method: 'PATCH' });
      const data = await res.json();
      alert(data.msg);
      location.reload();
    }

    async function deletePixel(id) {
      if (!confirm('Are you sure you want to delete this pixel?')) return;
      const res = await fetch(`https://helpyourfather.onrender.com/api/admin/pixels/${id}`, { method: 'DELETE' });
      const data = await res.json();
      alert(data.msg);
      location.reload();
    }

    fetchPixels();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
